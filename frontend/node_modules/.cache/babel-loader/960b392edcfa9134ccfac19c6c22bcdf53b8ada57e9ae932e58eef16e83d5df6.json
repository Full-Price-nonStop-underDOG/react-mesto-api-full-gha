{"ast":null,"code":"import _objectSpread from\"/Users/bogdanus/Desktop/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/bogdanus/Desktop/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/bogdanus/Desktop/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/bogdanus/Desktop/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/bogdanus/Desktop/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{authenticationElemenetsApi}from'./constants';var Api=/*#__PURE__*/function(){function Api(_ref){var headers=_ref.headers,URL=_ref.URL;_classCallCheck(this,Api);this._headers=headers;this._url=URL;}_createClass(Api,[{key:\"_handlePromiseRequest\",value:function _handlePromiseRequest(res){if(res.ok){return res.json();}else throw new Error('ошибка');}},{key:\"register\",value:function(){var _register=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(email,password){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"\".concat(this._url,\"/sign-up\"),{method:'POST',headers:this._headers,body:JSON.stringify({email:email,password:password})});case 3:response=_context.sent;_context.next=6;return this._handlePromiseRequest(response);case 6:data=_context.sent;return _context.abrupt(\"return\",data);case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);throw new Error(_context.t0);case 13:case\"end\":return _context.stop();}},_callee,this,[[0,10]]);}));function register(_x,_x2){return _register.apply(this,arguments);}return register;}()},{key:\"login\",value:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(email,password){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"\".concat(this._url,\"/signin\"),{method:'POST',headers:this._headers,body:JSON.stringify({email:email,password:password})});case 3:response=_context2.sent;_context2.next=6;return this._handlePromiseRequest(response);case 6:data=_context2.sent;if(!data.token){_context2.next=10;break;}localStorage.setItem('jwt',data.token);return _context2.abrupt(\"return\",data);case 10:_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);throw new Error(_context2.t0);case 15:case\"end\":return _context2.stop();}},_callee2,this,[[0,12]]);}));function login(_x3,_x4){return _login.apply(this,arguments);}return login;}()},{key:\"getToken\",value:function getToken(){return localStorage.getItem('jwt');}},{key:\"checkToken\",value:function(){var _checkToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(token){var response,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(\"\".concat(this._url,\"/users/me\"),{method:'GET',headers:_objectSpread(_objectSpread({},this._headers),{},{Authorization:\"Bearer \".concat(token)// Передаем токен в заголовке запроса\n})});case 3:response=_context3.sent;_context3.next=6;return this._handlePromiseRequest(response);case 6:data=_context3.sent;return _context3.abrupt(\"return\",data);case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);throw new Error(_context3.t0);case 13:case\"end\":return _context3.stop();}},_callee3,this,[[0,10]]);}));function checkToken(_x5){return _checkToken.apply(this,arguments);}return checkToken;}()}]);return Api;}();var authenticationApi=new Api(authenticationElemenetsApi);export default authenticationApi;","map":{"version":3,"names":["authenticationElemenetsApi","Api","_ref","headers","URL","_classCallCheck","_headers","_url","_createClass","key","value","_handlePromiseRequest","res","ok","json","Error","_register","_asyncToGenerator","_regeneratorRuntime","mark","_callee","email","password","response","data","wrap","_callee$","_context","prev","next","fetch","concat","method","body","JSON","stringify","sent","abrupt","t0","stop","register","_x","_x2","apply","arguments","_login","_callee2","_callee2$","_context2","token","localStorage","setItem","login","_x3","_x4","getToken","getItem","_checkToken","_callee3","_callee3$","_context3","_objectSpread","Authorization","checkToken","_x5","authenticationApi"],"sources":["/Users/bogdanus/Desktop/dev/react-mesto-auth/src/utils/AuthenticationApi.js"],"sourcesContent":["import { authenticationElemenetsApi } from './constants';\n\nclass Api {\n  constructor({ headers, URL }) {\n    this._headers = headers;\n    this._url = URL;\n  }\n\n  _handlePromiseRequest(res) {\n    if (res.ok) {\n      return res.json();\n    } else throw new Error('ошибка');\n  }\n\n  async register(email, password) {\n    try {\n      const response = await fetch(`${this._url}/sign-up`, {\n        method: 'POST',\n        headers: this._headers,\n\n        body: JSON.stringify({\n          email: email,\n          password: password,\n        }),\n      });\n      const data = await this._handlePromiseRequest(response);\n      return data;\n    } catch (error) {\n      throw new Error(error);\n    }\n  }\n\n  async login(email, password) {\n    try {\n      const response = await fetch(`${this._url}/signin`, {\n        method: 'POST',\n        headers: this._headers,\n        body: JSON.stringify({\n          email: email,\n          password: password,\n        }),\n      });\n      const data = await this._handlePromiseRequest(response);\n      if (data.token) {\n        localStorage.setItem('jwt', data.token);\n        return data;\n      }\n    } catch (error) {\n      throw new Error(error);\n    }\n  }\n\n  getToken() {\n    return localStorage.getItem('jwt');\n  }\n\n  async checkToken(token) {\n    //const token = this.getToken(); // Получаем токен из localStorage\n\n    try {\n      const response = await fetch(`${this._url}/users/me`, {\n        method: 'GET',\n        headers: {\n          ...this._headers,\n          Authorization: `Bearer ${token}`, // Передаем токен в заголовке запроса\n        },\n      });\n      const data = await this._handlePromiseRequest(response);\n      return data;\n    } catch (error) {\n      throw new Error(error);\n    }\n  }\n}\n\nconst authenticationApi = new Api(authenticationElemenetsApi);\nexport default authenticationApi;\n"],"mappings":"upBAAA,OAASA,0BAA0B,KAAQ,aAAa,CAAC,GAEnD,CAAAC,GAAG,yBACP,SAAAA,IAAAC,IAAA,CAA8B,IAAhB,CAAAC,OAAO,CAAAD,IAAA,CAAPC,OAAO,CAAEC,GAAG,CAAAF,IAAA,CAAHE,GAAG,CAAAC,eAAA,MAAAJ,GAAA,EACxB,IAAI,CAACK,QAAQ,CAAGH,OAAO,CACvB,IAAI,CAACI,IAAI,CAAGH,GAAG,CACjB,CAACI,YAAA,CAAAP,GAAA,GAAAQ,GAAA,yBAAAC,KAAA,CAED,SAAAC,sBAAsBC,GAAG,CAAE,CACzB,GAAIA,GAAG,CAACC,EAAE,CAAE,CACV,MAAO,CAAAD,GAAG,CAACE,IAAI,CAAC,CAAC,CACnB,CAAC,IAAM,MAAM,IAAI,CAAAC,KAAK,CAAC,QAAQ,CAAC,CAClC,CAAC,GAAAN,GAAA,YAAAC,KAAA,gBAAAM,SAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAED,SAAAC,QAAeC,KAAK,CAAEC,QAAQ,MAAAC,QAAA,CAAAC,IAAA,QAAAN,mBAAA,GAAAO,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAEH,CAAAC,KAAK,IAAAC,MAAA,CAAI,IAAI,CAACxB,IAAI,aAAY,CACnDyB,MAAM,CAAE,MAAM,CACd7B,OAAO,CAAE,IAAI,CAACG,QAAQ,CAEtB2B,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBd,KAAK,CAAEA,KAAK,CACZC,QAAQ,CAAEA,QACZ,CAAC,CACH,CAAC,CAAC,QARIC,QAAQ,CAAAI,QAAA,CAAAS,IAAA,CAAAT,QAAA,CAAAE,IAAA,SASK,KAAI,CAAClB,qBAAqB,CAACY,QAAQ,CAAC,QAAjDC,IAAI,CAAAG,QAAA,CAAAS,IAAA,QAAAT,QAAA,CAAAU,MAAA,UACHb,IAAI,UAAAG,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAAW,EAAA,CAAAX,QAAA,kBAEL,IAAI,CAAAZ,KAAK,CAAAY,QAAA,CAAAW,EAAM,CAAC,0BAAAX,QAAA,CAAAY,IAAA,MAAAnB,OAAA,iBAEzB,YAAAoB,SAAAC,EAAA,CAAAC,GAAA,SAAA1B,SAAA,CAAA2B,KAAA,MAAAC,SAAA,UAAAJ,QAAA,OAAA/B,GAAA,SAAAC,KAAA,gBAAAmC,MAAA,CAAA5B,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAED,SAAA2B,SAAYzB,KAAK,CAAEC,QAAQ,MAAAC,QAAA,CAAAC,IAAA,QAAAN,mBAAA,GAAAO,IAAA,UAAAsB,UAAAC,SAAA,iBAAAA,SAAA,CAAApB,IAAA,CAAAoB,SAAA,CAAAnB,IAAA,SAAAmB,SAAA,CAAApB,IAAA,GAAAoB,SAAA,CAAAnB,IAAA,SAEA,CAAAC,KAAK,IAAAC,MAAA,CAAI,IAAI,CAACxB,IAAI,YAAW,CAClDyB,MAAM,CAAE,MAAM,CACd7B,OAAO,CAAE,IAAI,CAACG,QAAQ,CACtB2B,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBd,KAAK,CAAEA,KAAK,CACZC,QAAQ,CAAEA,QACZ,CAAC,CACH,CAAC,CAAC,QAPIC,QAAQ,CAAAyB,SAAA,CAAAZ,IAAA,CAAAY,SAAA,CAAAnB,IAAA,SAQK,KAAI,CAAClB,qBAAqB,CAACY,QAAQ,CAAC,QAAjDC,IAAI,CAAAwB,SAAA,CAAAZ,IAAA,KACNZ,IAAI,CAACyB,KAAK,EAAAD,SAAA,CAAAnB,IAAA,WACZqB,YAAY,CAACC,OAAO,CAAC,KAAK,CAAE3B,IAAI,CAACyB,KAAK,CAAC,CAAC,OAAAD,SAAA,CAAAX,MAAA,UACjCb,IAAI,UAAAwB,SAAA,CAAAnB,IAAA,kBAAAmB,SAAA,CAAApB,IAAA,IAAAoB,SAAA,CAAAV,EAAA,CAAAU,SAAA,kBAGP,IAAI,CAAAjC,KAAK,CAAAiC,SAAA,CAAAV,EAAM,CAAC,0BAAAU,SAAA,CAAAT,IAAA,MAAAO,QAAA,iBAEzB,YAAAM,MAAAC,GAAA,CAAAC,GAAA,SAAAT,MAAA,CAAAF,KAAA,MAAAC,SAAA,UAAAQ,KAAA,OAAA3C,GAAA,YAAAC,KAAA,CAED,SAAA6C,SAAA,CAAW,CACT,MAAO,CAAAL,YAAY,CAACM,OAAO,CAAC,KAAK,CAAC,CACpC,CAAC,GAAA/C,GAAA,cAAAC,KAAA,gBAAA+C,WAAA,CAAAxC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAED,SAAAuC,SAAiBT,KAAK,MAAA1B,QAAA,CAAAC,IAAA,QAAAN,mBAAA,GAAAO,IAAA,UAAAkC,UAAAC,SAAA,iBAAAA,SAAA,CAAAhC,IAAA,CAAAgC,SAAA,CAAA/B,IAAA,SAAA+B,SAAA,CAAAhC,IAAA,GAAAgC,SAAA,CAAA/B,IAAA,SAIK,CAAAC,KAAK,IAAAC,MAAA,CAAI,IAAI,CAACxB,IAAI,cAAa,CACpDyB,MAAM,CAAE,KAAK,CACb7B,OAAO,CAAA0D,aAAA,CAAAA,aAAA,IACF,IAAI,CAACvD,QAAQ,MAChBwD,aAAa,WAAA/B,MAAA,CAAYkB,KAAK,CAAI;AAAA,EAEtC,CAAC,CAAC,QANI1B,QAAQ,CAAAqC,SAAA,CAAAxB,IAAA,CAAAwB,SAAA,CAAA/B,IAAA,SAOK,KAAI,CAAClB,qBAAqB,CAACY,QAAQ,CAAC,QAAjDC,IAAI,CAAAoC,SAAA,CAAAxB,IAAA,QAAAwB,SAAA,CAAAvB,MAAA,UACHb,IAAI,UAAAoC,SAAA,CAAAhC,IAAA,IAAAgC,SAAA,CAAAtB,EAAA,CAAAsB,SAAA,kBAEL,IAAI,CAAA7C,KAAK,CAAA6C,SAAA,CAAAtB,EAAM,CAAC,0BAAAsB,SAAA,CAAArB,IAAA,MAAAmB,QAAA,iBAEzB,YAAAK,WAAAC,GAAA,SAAAP,WAAA,CAAAd,KAAA,MAAAC,SAAA,UAAAmB,UAAA,eAAA9D,GAAA,KAGH,GAAM,CAAAgE,iBAAiB,CAAG,GAAI,CAAAhE,GAAG,CAACD,0BAA0B,CAAC,CAC7D,cAAe,CAAAiE,iBAAiB"},"metadata":{},"sourceType":"module","externalDependencies":[]}